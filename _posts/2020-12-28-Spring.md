# Spring 

## 一、Spring框架基本概述

 1、Spring是轻量级的开源的JavaEE框架 

 2、Spring可以解决企业应用开发的复杂性 

 3、Spring有两个核心部分：IOC和Aop 

（1）IOC：控制反转，把创建对象过程交给Spring进行管理 ；

（2）Aop：面向切面，不修改源代码进行功能增强 ；

 4、Spring特点 

（1）方便解耦，简化开发 

（2）Aop编程支持 

（3）方便程序测试 

（4）方便和其他框架进行整合 

（5）方便进行事务操作 

（6）降低API开发难度 

### 1.1 入么实战

**第一步：导入相应的依赖（Jar 包）**

```xml
<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-beans</artifactId>
    <version>${Spring-version}</version>
    <scope>compile</scope>
</dependency>

<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-context</artifactId>
    <version>${Spring-version}</version>
    <scope>compile</scope>
</dependency>

<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-core</artifactId>
    <version>${Spring-version}</version>
    <scope>compile</scope>
</dependency>

<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-expression</artifactId>
    <version>${Spring-version}</version>
    <scope>compile</scope>
</dependency>

<dependency>
    <groupId>commons-logging</groupId>
    <artifactId>commons-logging</artifactId>
    <version>1.1.1</version>
</dependency>
```

第二步：新建配置文件

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">
    <!-- 全类名-->
    <bean id="user" class="com.restart.bean.User"/>
</beans>
```

 第三步：测试类

```java
public class Test {
    @org.junit.Test
    public void testAdd(){
        //1、加载配置文件
        ClassPathXmlApplicationContext classPathXmlApplicationContext =
                new ClassPathXmlApplicationContext("bean.xml");

        // 2、获取对象
        User user = classPathXmlApplicationContext.getBean("user", User.class);
        System.out.println(user);
        user.add();
    }
}
```

## 二、IOC 容器（控制反转容器）

### 2.1 底层原理

​	**什么是IOC**？控制反转，把对象的创建以及对象的调用过程，交给Spring容器完成，程序员只需要操作相关的配置文件，使用IOC的目的是降低耦合。之前的入门案例用的就是IOC实现；

​	**IOC底层原理：**工厂模式、XML配置文件，反射；

![image-20201229160944472](/Users/anner/Library/Application Support/typora-user-images/image-20201229160944472.png)

![image-20201229161201343](/Users/anner/Library/Application Support/typora-user-images/image-20201229161201343.png)

![image-20201229161700274](/Users/anner/Library/Application Support/typora-user-images/image-20201229161700274.png)

### 2.2 IOC 接口（BeanFactory）

IOC的思想是拘役IOC容器完成的，IOC容器底层就是对象工厂（工厂设计模式）；

**Spring提供了IOC容器的两种实现方式（两个接口）：BeanFactory、ApplicationContext**

**BeanFactory：**IOC容器基本实现，是Spring内部的使用接口，不提供开发人员进行使用 * 加载配置文件时候不会创建对象，在获取对象（使用）才去创建对象 ;

**ApplicationContext：**BeanFactory接口的子接口，提供更多更强大的功能，一般由开发人员进行使用 ,加载配置文件时候就会把在配置文件对象进行创建 ,开发过程中，推荐使用，将耗时耗资源的操作，都在服务器启动的时候创建完成，这样用户体验更好；

 **ApplicationContext 的实现类：**

![image-20201229185444835](/Users/anner/Library/Application Support/typora-user-images/image-20201229185444835.png)

**FileSystemXmlApplicationContext**  在使用时，调用时需要写配置文件的在系统中的位置；

**ClassPathXmlApplicationContext** 在使用时，只需要系统中的相对位置；



### 2.3 IOC操作Bean管理（基于XML）

**Bean 管理**： 由Spring 进行对象创建，用Spring注入属性；

**对象创建：**

```xml
<bean id="user" class="com.restart.bean.User"/>
 <!--
     ID 属性，对象的唯一表示
     class 属性，类的全类名；

     Spring 容器在创建对象时，默认使用类的午餐构造器。完成对象的创建；
    -->
```

就是在Spring配置文件中，声明类。然后，再加载配置文件，进行调用；



**属性注入：**

DI：依赖注入，就是注入属性。需要在对象已创建的基础上进行注入；

```java
public class Book {

    private String bname;

    public Book() {
    }

    public Book(String bname) {
        this.bname = bname;
    }

    public void setBname(String bname) {
        this.bname = bname;
    }

    public static void main(String[] args) {
        Book book = new Book();
        //方法一：set 方法注入
        book.setBname("abc");

        //方法二 构造器
        Book acb = new Book("acb");
        
    }
}
```

方法一：**使用Set方法进行属性注入**

 **第一步：**创建类，定义属性，以及属性的set方法

```java
public class Book {

    private String bname;

    private String bAuthorl;

    public void setBname(String bname) {
        this.bname = bname;
    }

    public void setbAuthorl(String bAuthorl) {
        this.bAuthorl = bAuthorl;
    }

    @Override
    public String toString() {
        return "Book{" +
                "bname='" + bname + '\'' +
                ", bAuthorl='" + bAuthorl + '\'' +
                '}';
    }
}
```

**第二步：**配置文件编写，注入属性

```xml
<!--    创建对象-->
<bean id="book" class="com.restart.bean.Book">
    <!-- 设置属性值-->
    <property name="bname" value="wawaw"/>
    <property name="bAuthorl" value="wawaw"/>
</bean>
```

**第三步：**测试

```java
@org.junit.Test
public void testBook(){
    //1、加载配置文件
    ApplicationContext classPathXmlApplicationContext =
            new ClassPathXmlApplicationContext("bean.xml");

    // 2、获取对象
   Book book = classPathXmlApplicationContext.getBean("book", Book.class);
    System.out.println(book);
}
```



**方法二：使用有参数的构造器进行注入**

 **第一步：**创建类，定义属性，以及属性的set方法

```java
public class Order {
    private String oname;
    private String address;

    public Order(String oname, String address) {
        this.oname = oname;
        this.address = address;
    }

    @Override
    public String toString() {
        return "Order{" +
                "oname='" + oname + '\'' +
                ", address='" + address + '\'' +
                '}';
    }
}
```

**第二步：**配置文件编写，注入属性

```xml
  <!--    使用有参构造器进行创建-->
    <bean id="order" class="com.restart.bean.Order">
        <constructor-arg name="oname" value="abc"/>
        <constructor-arg name="address" value="abc"/>
    </bean>

```

**第三步：**测试

```java
 @org.junit.Test
    public void testOrders() {
        //1、加载配置文件
        ApplicationContext classPathXmlApplicationContext =
                new ClassPathXmlApplicationContext("bean.xml");

        // 2、获取对象
        Order order = classPathXmlApplicationContext.getBean("order", Order.class);
        System.out.println(order);
    }
```



**注入其他类型的属性**

1、 注入属性（外部Bean）

```java
/**
（1）创建两个类 service类和dao类 
（2）在service调用dao里面的方法 
（3）在spring配置文件中进行配置 
  
  */
  
  public class UserService { //创建UserDao类型属性，生成set方法 
    private UserDao userDao; 
    public void setUserDao(UserDao userDao) { 
      this.userDao = userDao; 
    } 
    public void add() { 
      System.out.println("service add..............."); 
      userDao.update(); 
    }
  }
  
```

```xml
<!--1 service和dao对象创建--> 
<bean id="userService" class="com.atguigu.spring5.service.UserService"> 
  <!--注入userDao对象 name属性：类里面属性名称 ref属性：创建userDao对象bean标签id值 --> 
  <property name="userDao" ref="userDaoImpl"></property> 
</bean>
<bean id="userDaoImpl" class="com.atguigu.spring5.dao.UserDaoImpl"></bean>
```



2、注入属性（注入内部Bean）

```java
/**
（1）一对多关系：部门和员工 一个部门有多个员工，一个员工属于一个部门 部门是一，员工是多 
（2）在实体类之间表示一对多关系，员工表示所属部门，使用对象类型属性进行表示 */
//部门类 
public class Dept 
{ 
  private String dname; 
  public void setDname(String dname) 
  { 
    this.dname = dname; 
  }
}


//员工类
public class Emp { 
  private String ename; 
  private String gender; 
  //员工属于某一个部门，使用对象形式表示 
  private Dept dept; 
  public void setDept(Dept dept) 
  { 
    this.dept = dept; 
  } 
  public void setEname(String ename)
  { 
    this.ename = ename; 
  } 
  public void setGender(String gender) 
  { 
    this.gender = gender;
  }
}
```

```xml
<!--级联赋值--> 
<bean id="emp" class="com.atguigu.spring5.bean.Emp"> 
  <!--设置两个普通属性--> 
  <property name="ename" value="lucy"></property> 
  <property name="gender" value="女"></property> 
  <!--级联赋值--> 
  <property name="dept" ref="dept"></property> 
  <property name="dept.dname" value="技术部"></property> 
</bean>
<bean id="dept" class="com.atguigu.spring5.bean.Dept"> 
  <property name="dname" value="财务部"></property>
</bean>
```



**3、注入集合**

```java
/**1**、注入数组类型属性 
**2**、注入**List**集合类型属性 
**3**、注入**Map**集合类型属性 
（1）创建类，定义数组、list、map、set类型属性，生成对应set方法 */

public class Stu { 
  //1 数组类型属性 
  private String[] courses; 
  //2 list集合类型属性
  private List<String> list; 
  //3 map集合类型属性 
  private Map<String,String> maps;
  //4 set集合类型属性 
  private Set<String> sets;
  public void setSets(Set<String> sets) 
  { 
    this.sets = sets; 
  } 
  public void setCourses(String[] courses) 
  { 
    this.courses = courses; 
  } 
  public void setList(List<String> list) 
  { 
    this.list = list; 
  } 
  public void setMaps(Map<String, String> maps) 
  { 
    this.maps = maps; 
  } 
}
```

```xml
<!--1 集合类型属性注入--> 
<bean id="stu" class="com.atguigu.spring5.collectiontype.Stu"> 
  <!--数组类型属性注入--> 
  <property name="courses"> 
    <array> <value>java课程</value> 
      <value>数据库课程</value> 
    </array> 
  </property>
  <!--list类型属性注入--> 
  <property name="list"> 
    <list> 
      <value>张三</value> 
      <value>小三</value> 
    </list> 
  </property> 
  <!--map类型属性注入--> 
  <property name="maps"> 
    <map> 
      <entry key="JAVA" value="java"></entry> 
      <entry key="PHP" value="php"></entry> 
    </map> 
  </property>
  <!--set类型属性注入--> 
  <property name="sets"> 
    <set> <value>MySQL</value> 
      <value>Redis</value> 
    </set> 
  </property> 
</bean>
```



### 2.4 IOC操作Bean管理（注解）

